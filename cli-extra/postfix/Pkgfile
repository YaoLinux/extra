makedepends=(libnsl db cyrus-sasl openssl icu mariadb openldap pcre postgresql sqlite)

description="Mail Transport Agent (MTA) for sending email to other users of your host machine"
url="http://www.postfix.org"

maintainer="rems"
packager="Yaolinux Team"

name=postfix
version=3.4.7
yaolinux_version=1.0-RC1

source=(http://downloads.yaolinux.org/yaolinux/files/yaolinux-${yaolinux_version}.tar.xz
	    ftp://ftp.porcupine.org/mirrors/postfix-release/official/$name-$version.tar.gz
        http://www.linuxfromscratch.org/patches/blfs/svn/postfix-$version-glibc230_fix-1.patch)

build() {

    cd $name-$version

    sed -i 's/.\x08//g' README_FILES/*

    patch -Np1 -i ../postfix-3.4.7-glibc230_fix-1.patch

	make CCARGS="-DUSE_TLS -I/usr/include/openssl/        \
	-DUSE_SASL_AUTH -DUSE_CYRUS_SASL -I/usr/include/sasl" \
	AUXLIBS="-lssl -lcrypto -lsasl2"                      \
	makefiles 
     
	make

	sh postfix-install -non-interactive \
	daemon_directory=$PKG/usr/lib/postfix \
	manpage_directory=$PKG/usr/share/man \
	html_directory=$PKG/usr/share/doc/postfix-$version/html \
	readme_directory=$PKG/usr/share/doc/postfix-$version/readme

    mkdir -pv $PKG/etc/
    cat >> $PKG/etc/aliases << "EOF"
# Begin /etc/aliases

MAILER-DAEMON:    postmaster
postmaster:       root

root:             <LOGIN>
# End /etc/aliases
EOF

	cd ../yaolinux-${yaolinux_version}
	make DESTDIR=$PKG install-postfix
}
