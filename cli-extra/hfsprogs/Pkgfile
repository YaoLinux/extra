description="HFS/HFS+ user space utils"
url="http://www.opensource.apple.com/"

maintainer="rems"
packager="Yaolinux Team"

makedepends=(libbsd openssl)

name=hfsprogs
version=540.1.linux3

source=(http://cavan.codon.org.uk/~mjg59/diskdev_cmds/diskdev_cmds-${version}.tar.gz
        https://src.fedoraproject.org/rpms/hfsplus-tools/raw/master/f/hfsplus-tools-no-blocks.patch
        https://src.fedoraproject.org/rpms/hfsplus-tools/raw/master/f/hfsplus-tools-learn-to-stdarg.patch
        ldflags_relro.patch)

build() {

 cd diskdev_cmds-${version}
  for patch in ../hfs*.patch
  do
    patch -Np1 -i ${patch}
  done
  
  patch -p0 -i "../ldflags_relro.patch"

  make -f Makefile
  
  install -m 755 -d ${PKG}/usr/bin
  install -m 755 -d ${PKG}/usr/share/${name}
  install -m 755 -d ${PKG}/usr/share/man/man8/
  
  install -m 755 newfs_hfs.tproj/newfs_hfs ${PKG}/usr/bin/mkfs.hfsplus
  install -m 755 fsck_hfs.tproj/fsck_hfs ${PKG}/usr/bin/fsck.hfsplus
  
  install -m 644 newfs_hfs.tproj/hfsbootdata.img ${PKG}/usr/share/${NAME}/hfsbootdata
  
  install -m 644 newfs_hfs.tproj/newfs_hfs.8 ${PKG}/usr/share/man/man8/mkfs.hfsplus.8
  install -m 644 fsck_hfs.tproj/fsck_hfs.8 ${PKG}/usr/share/man/man8/fsck.hfsplus.8
}

